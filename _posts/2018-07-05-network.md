---
layout: post
title:  "网络相关"
date:   2018-07-05 08:08:00
categories: S
excerpt: 网络相关知识
---

# 减少用户态与内核态的内存拷贝
- read换mmap,读文件共享内核内存

```
风险:当mmap多进程/线程使用时,后续操作可能因其他进程/线程修改mmap导致crash
处理:1.捕捉SIGBUS信号并直接返回,后续操作也被终止
    2.fcntl(fd, F_SETSIG, RT_SIGNAL_LEASE)
      fcntl(fd, F_SETLEASE, l_type) 设置文件中断信号,捕捉信号后终止后续操作
```
- sendfile 替换read/mmap+write的组合,直接内核操作

```
风险:1.mmap一样,最好设置RT_SIGNAL_LEASE信号,不要抛出SIGBUS信号
    2.非POXI标准,移植问题
```

