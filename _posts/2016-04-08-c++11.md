---
layout: post
title:  "C\C++ 11"
date:   2016-01-04 11:36:00
categories: Other
excerpt: C\C++11 特性。
---

* content
{:toc}

# C++ 11
1. auto
    
        使用计算的实际类型，忽略顶层的const
        auto 函数名()->返回类型

2. decltype

        不计算只推断类型，变量与表达式结果不同
        自动生成返回类型

3. 语法特点
    
        % 取被余数的符号，商向0靠
        {} 初始化不允许丢失精度,可用于return
        位运算 对符号位没定义，移位超出或负数未定义
        sizeof运算符不求值、可以使用类作用域来访问属性
        for(declaration:expression)
        容器不可以在循环中增删，因为预存了end
        using name=type 等价 typedef
        不同作用域不会重载函数,引用、指针有const修饰也是重载

# C 98
01. register 编译优化时尽量将变量保存在寄存器中
02. volatile 变量会被其它线程修改,每次使用读取内存

# C 99
01. inline
02. restrict 修饰指针 表示此指针是这块内存地址的唯一指针

        int add(int *restrict a, int *restrict b) {
            *a = 5;
            *b = 6;
            return *a + *b;这里不用担心a与b指向相同的内存,因此汇编时不需要判断a指向的值变成6.
        }
    
3.  _Bool <stdbool.h> 是数字不能用true false
4. _Complex <complex.h> 复数
5. _Imaginary 虚数

# C 11
01. <stdalign.h> alignof aligned_alloc
02. _Noreturn void fxxx(xxx) 无法返回
03. _Generic 泛型函数

        void* func_int(int x){....}
        void* func_float(float x){....}
        void* func_char(char x){....}
        void* func_str(char *x){....}
        #defined func_all(x) _Generic((x), int:func_int, float:func_float, char:func_char, char*:func_str, default:func_int)(x);
        也可以是变量
        int a, c = 0;
        _Generic(x, int:a, float:c, default:a)++
        
04. <threads.h> 语言线程支持
    
        _Thread_local thrd_create thrd_exit
        mtx_lock mtx_unlock
    
05. <stdatomic.h> _Atomic
06. <uchar.h> Unicode 支持
07. quick_exit() exit()失败后,可以强制结束
08. CMPLX() 复数宏
09. <time.h> struct timespec 纳秒支持
10. _Alignas 在定义前 指定字节对齐

            _Alignas(4) int x;
            _Alignas(8) struct name {....}
            
11. _Alignof 获取变量 类型的对齐方式
12. _Atomic 原子变量 atomic_store 等
13. _Static_assert 编译起的assert

## 工具
01. objdump
02. otool(mac)
03. codesign(mac)
04. lipo(mac)
05. nm

## 头文件搜索
1. C_INCLUDE_PATH   xx:xx
2. CPLUS_INCLUDE_PATH xx:xx
3. OBJC_INCLUDE_PATH xx:xx
4. -nostdinc 不搜索系统路径及上诉变量指定的路径
5. PKG_CONFIG_PATH

## 库搜索优先级
1. 编译目标代码时指定的动态库搜索路径
2. 环境变量LD_LIBRARY_PATH指定的动态库搜索路径
3. 配置文件/etc/ld.so.conf中指定的动态库搜索路径
4. /lib
5. /usr/lib
6. PKG_CONFIG_PATH

## 库管理工具
- [vcpkg](https://github.com/Microsoft/vcpkg)
    - 不支持版本控制
    - 使用git,cmake每个客户端自动编译
- [Conan](https://github.com/conan-io/conan)

## 编译参数
- \-static 后面的是静态链接库
- \–Bdynamic 后面是动态库
- \-Bstatic 后面是静态库
- \-Wl 后面的参数传递给链接器
- \-Wl,\-\-whole-archive 链接所有函数,不删除未使用的函数(包括三方静态库）
- \-Wl,\-\-no-whole-archive 恢复函数裁剪,删除不使用的函数

## Conan
- Artifactory
    - [Artifactory](https://jfrog.com/zh/artifactory/)
    - [Artifactory source](https://api.bintray.com/content/jfrog/artifactory/jfrog-artifactory-oss-$latest-sources.tar.gz;bt_package=jfrog-artifactory-oss-zip)
    - [Artifactory crack](https://github.com/r4p3-iooi/artifactory-injector)
    - 强大支持各种不同的源版本存储管理服务器
- JFrog Bintray 包分布式分发系统
- conan_sever 自带的包管理,没有权限及UI
- [cmake-conan](https://github.com/conan-io/cmake-conan)
- [docker](https://github.com/conan-io/conan-docker-tools)
- [介绍](https://docs.conan.io) 
- conanfile.txt #conan install -s os="Linux" -s compiler="gcc"

```
include(default)
[settings]
os=Macos
arch=x86_64
compiler=clang
compiler.version=3.5
compiler.libcxx=libstdc++11
build_type=Release
[env]
CC=/usr/bin/clang
CXX=/usr/bin/clang++
[requires]
ssl/1.0.1@eastmoney/stable      #库/版本@存储商/版本类型
[generators]
cmake                           #编译方式,cmake需要有CMakeLists.txt、gcc
[options]
ssl:shared=True                 #选项
[imports]
bin,*.dll -> ./bin              #将动态库导入可执行文件的目录
```
