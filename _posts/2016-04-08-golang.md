---
layout: post
title:  "GO 语言"
date:   2016-04-08 09:01:00
categories: Server
excerpt: GO 语法。
---

* content
{:toc}

##环境
01. https://golang.org/
02. .bash_profile export GOROOT=/usr/local/go 
03. export GOPATH=/Users/nomadli/src/golang
04. export PATH=$PATH:$/bin:$GOPATH/bin
05. export http_proxy=http://127.0.0.1:1087;
06. export https_proxy=http://127.0.0.1:1087;
07. export rsync_proxy=$http_proxy
08. source ~/.bash_profile
09. https://code.visualstudio.com/
10. 安装Go插件
11. Code->首选项->设置
12. go get -u -v github.com/nsf/gocode
13. go get -u -v github.com/rogpeppe/godef
14. go get -u -v github.com/zmb3/gogetdoc
15. go get -u -v github.com/golang/lint/golint
16. go get -u -v github.com/lukehoban/go-outline
17. go get -u -v sourcegraph.com/sqs/goreturns
18. go get -u -v golang.org/x/tools/cmd/gorename
19. go get -u -v github.com/tpng/gopkgs
20. go get -u -v github.com/newhook/go-symbols
21. go get -u -v golang.org/x/tools/cmd/guru
22. go get -u -v github.com/cweill/gotests
23. go get -v -u github.com/peterh/liner
24. go get -v -u github.com/derekparker/delve/cmd/dlv
25. brew install go-delve/delve/delve
26. 钥匙串访问->证书助理->创建证书 名称：dIv 身份类型：自签名证书 证书类型：代码签名 并选择“让我覆盖这些默认值” 
27. 重启Finder，再打开“钥匙串访问”，选择“系统”，就会看到创建好的“dlv-cert”证书
28. 右键”dlv-cert”证书，选择“显示简介->信任->代码签名”修改为：始终信任 
29. cd $GOPATH/src/github.com/derekparker/delve
30. GO15VENDOREXPERIMENT=1 CERT=dlv-cert make install
31. xcode-select --install
32. go build -o 输出文件名
33. go build -i 安装依赖包
34. go build/clean/get/install/list/run/test

        -a 完全编译,忽略-i产生的.a
        -n 打印编译输出,不实际编译
        -p 16 多核编译 默认检查cpu核数
        -race 检测数据竞争状态只支持amd64
        -msan
        -v 打印编译的包名
        -work 打印临时目录,并且退出时不删除
        -x 打印输出执行的命令
        -asmflags ‘xxxx’ 传递给go工具asm的调用参数
        -buildmode mode #shared static
        -compiler name 编译器
        -gccgoflags ‘’ gccgo编译器的编译参数
        -gcflags ‘’ 垃圾回收参数
        -installsuffix suffix 安装前缀
        -ldflags packname.VarName= 为代码中变量赋值 如果编译版本、日期等
        -ldflags -s 去掉符号表
        -ldflags -w 去掉调试信息
        -linkshared 链接共享库
        -pkgdir dir 链接包信息位置
        -tags ‘’ 指定tag版本
        -toolexec ‘’ 替代编译链接等步骤使用的工具

## 安装手机开发分支
01. .bash_profile export http_proxy https_proxy ...
02. go get golang.org/x/mobile/cmd/gomobile
03. gomobile init
04. 原生开发、兼容开发有限制 

## 原生开发 Android
01. gomobile build -target=android xx/xx/xxx
02. gomobile install xx/xx/xxx
03. 例子 go get -d golang.org/x/mobile/example/basic
04. 做动态库可以直接在Android Studio里面编译 

## 原生开发 IOS
01. gomobile build -target=ios xx/xx/xxx
02. ios-deploy https://github.com/phonegap/ios-deploy
03. ios-deploy -b xxx.app
04. 例子 go get -d golang.org/x/mobile/example/basic 
05. 作为库 gomobile bind -target=ios xx/xx/xx 

## web 网站
01. A Survey of 5 Go Web Frameworks 框架
02. Gorilla web toolkit 

## 兼容开发 Android
01. android studio
02. build.gradle 配置
03. 例子 go get -d golang.org/x/mobile/example/bind/android

## 兼容开发 IOS
01. gomobile bind -target=ios xx/xx/xxx 生成framework
02. 例子 go get -d golang.org/x/mobile/example/bind/ios

## 跨平台
01. CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build
02. CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build
3.  windows, unix, posix, plan9, darwin, bsd, linux, freebsd, nacl, netbsd, openbsd, solaris, dragonfly, bsd, notbsd, android, stubs
4.  amd64, none, 386, arm, arm64, mips64, s390,mips64x,ppc64x, nonppc64x, s390x, x86, amd64p32  
05. 文件后缀条件编译

        go list -f '{{.GoFiles}}' 目录   查看目录下将被编译的文件
        xxx_windows_386.go 只在window 386下被编译的文件
        xxx_unix_arm.go 只在unix兼容POSIX的平台上被编译的文件
        xxx_unix_arm_test.go 只在unix兼容POSIX的平台上的测试文件
        
06.  // +build 条件编译标签 在package前 并且要有空行

        // +build linux darwin  linux 或 darwin
        // +build 386           并且是386
        
        // +build linux, 386    linux 并且 386
        
        // +build !windows      非windows环境编译
        

## 语法
01. obj.(interface_name) 强制转为某种interface类型
02. func init(a int, b double, opt ... int) int64, char 

## 监控
01. net/http/pprof http://localhost:port/debug/pprof/
02. go tool pprof http://localhost:port/debug/pprof/
03. runtime/pprof
04. pprof.StartCPUProfile(f)
05. pprof.StopCPUProfile()
06. pprof.Lookup("heap")
07. pprof.Lookup("threadcreate")
08. pprof.Lookup("block")
09. pprof.WriteHeapProfile(f)
10. pprof.StopHeapProfile()
11. GOGCTRACE=1

##json
    type Product struct {
        Name string `json:"name,string"`
        NoJson int64 `json:"-"`// 表示不进行序列化
        num int `json:"num,omitempty"`//忽略0和nil
        Price float64 `json:"price,number"`
        IsOn  bool `json:"is_on,boolean"`
    }
    Value.Type().Field(i).Tag.Get("json")

## reflect
001. Type 
002. Value = reflect.ValueOf(interface{})

## Value 
001. nil只能调用 IsValid String Kind !=reflect.Ptr为nil
002. Kind reflect.Struct reflect.Slice reflect.Array reflect.Map reflect.Func 不是具体类
003. Type() 具体类型
004. CanAddr() Addr()
005. Elem() Kind()==reflect.Interface || reflect.Ptr 可调返回内容或指针
006. Set(reflect.New(v.Type()) Type必须不是指针，所以循环Elem到非指针
007. Type().NumMethod()
008. Type().NumField() Type().Field(i).Tag.Get("json")
009. Type().Name()

## cgo
001. export PKG_CONFIG_PATH=
002. export LD_LIBRARY_PATH=
003. +build !static +build static_all  
004. \#cgo pkg-config: --static libname
005. \#cgo LDFLAGS: -static -llibnmae -Wl -Bstatic -Bdynamic -L..
006. 文件名约束 xx_linux.go xx_windows_amd64.go 
007. +build linux,386 darwin,!cgo 
008. \#cgo [darwin linux windows] CFLAGS: -I ${SRCDIR}/...

## go 命令
001. go list ./... 列出所有当前目录及子目录中的go源文件
002. go env 显示go环境变量,可以指定显示key如GOPATH

## C、C++ 协程库
- libco https://github.com/Tencent/libco.git
- libgo https://github.com/yyzybb537/libgo.git

## go 启动过程
001. goruntime goexit
002. goruntime func main()
003. 引用的库递归init函数->mian.init

## go 常用函数
方法|作用
:--|:--
runtime.GOOS|判断操作系统
os.Args|命令行参数
os.Environ|系统环境变量
string os.Getwd|当前绝对目录
FileInfo os.Stat|文件目录信息
FileInfo.IsDir|是否文件
File os.Open|打开文件
PrivateKey rsa.GenerateKey|生成密钥
Signer NewSignerFromSigner|生成签名
PublicKey ParseAuthorizedKey|从文件加载密钥
[]byte Marshal|序列化密钥
net.Listen|监听数据流
net.ListenPacket|监听数据块
Accept|接收数据流链接
net.Dial|链接远程
ServerConn ssh.NewServerConn|将链接传给ssh握手
net.Addr ServerConn.RemoteAddr|获取远程地址
User user.Current|获取当前用户
User.HomeDir|获取主目录
Cmd exec.Command|执行命令的环境进程
Cmd.Env|环境变量
Cmd.StdinPipe|标准输入
Cmd.Stdout|标准输出
Cmd.Stderr|错误输出
Cmd.Run|执行命令
