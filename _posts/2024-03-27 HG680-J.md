---
layout:         post
title:          ttl 串口
subtitle:       ttl 串口相关
date:           2024-03-27 12:56:00
author:         nomadli
header-img:     ../img/bg-coffee.jpeg
catalog:        true
tags:
        - android
---

* content
{:toc}

## CH340芯片
- 主要作用是代替FT232、PL2303等芯片做USB转串口通信, 并价格便宜
- 内置USB转串口、自动检测串口通信参数、自动识别串口的波特率、校验位。
- 支持RS232、RS485、TTL等，支持8位数据位、1位停止位、无校验位等
- 内置了USB上拉电阻，UD+和UD-引脚应该直接连接到USB总线上。
- 内置了电源上电复位电路。
- 正常工作时需要外部向XI引脚提供12MHz的时钟信号。一般情况下，时钟信号由CH340内置的反相器通过晶体稳频振荡产生。外围电路只需要在XI和XO引脚之间连接一个12MHz的晶体，并且分别为XI和XO引脚对地连接振荡电容。
- 支持5V电源电压或者3.3V电源电压。当使用5V工作电压时，CH340芯片的VCC引脚输入外部5V电源，并且V3引脚应该外接容量为4700pF或者0.01uF的电源退耦电容。当使用3.3V工作电压时，CH340芯片的V3引脚应该与VCC引脚相连接，同时输入外部的3.3V电源，并且与CH340芯片相连接的其它电路的工作电压不能超过3.3V。
- 自动支持USB设备挂起以节约功耗，NOS#引脚为低电平时将禁止USB设备挂起。异步串口方式下CH340芯片的引脚包括：数据传输引脚、MODEM联络信号引脚、辅助引脚。数据传输引脚包括：TXD引脚和RXD引脚。串口输入空闲时，RXD应该为高电平，如果R232引脚为高电平启用辅助RS232功能，那么RXD引脚内部自动插入一个反相器，默认为低电平。串口输出空闲时，CH340T芯片的TXD为高电平，CH340R芯片的TXD为低电平。
- MODEM联络信号引脚包括：CTS#引脚、DSR#引脚、RI#引脚、DCD#引脚、DTR#引脚、RTS#引脚。所有这些MODEM联络信号都是由计算机应用程序控制并定义其用途。
- 辅助引脚包括：IR#引脚、R232引脚、CKO引脚、ACT#引脚。IR#引脚为低电平将启用红外线串口模式。R232引脚用于控制辅助RS232功能，R232为高电平时RXD引脚输入自动反相。ACT#引脚为USB设备配置完成状态输出（例如USB红外适配器就绪）。IR#和R232引脚只在上电复位后检查一次。
- 内置了独立的收发缓冲区，支持单工、半双工或者全双工异步串行通讯。串行数据包括1个低电平起始位、5、6、7或8个数据位、1个或2个高电平停止位，支持奇校验/偶校验/标志校验/空白校验。CH340支持常用通讯波特率：50、75、100、110、134.5、150、300、600、900、1200、1800、2400、3600、4800、9600、14400、19200、28800、33600、38400、56000、57600、76800、115200、128000、153600、230400、460800、921600、1500000、2000000等。串口发送信号的波特率误差小于0.3％，串口接收信号的允许波特率误差不小于2％。
- 在计算机端的Windows操作系统下，CH340的驱动程序能够仿真标准串口，所以绝大部分原串口应用程序完全兼容，通常不需要作任何修改。
- 可以用于升级原串口外围设备，或者通过USB总线为计算机增加额外串口。通过外加电平转换器件，可以进一步提供RS232、RS485、RS422等接口。
- 只需外加红外线收发器，就可以通过USB总线为计算机增加SIR红外适配器，实现计算机与符合IrDA规范的外部设备之间的红外线通讯。
- 我的GND 5V TXD RXD DTR 3.3V 189189

型号|封装|功能特点
|:-:|:-|:-|
CH340G|SOP16|经典型号
CH340C|SOP16|免晶振，引脚兼容CH340G
CH340N|SOP8|免晶振，小封装
CH340E|MSOP10|免晶振，小封装
CH340K|ESSOP10|免晶振，内置防倒灌电路
CH340B|SOP16|免晶振，内置EEPROM可修改PID VID等 引脚兼容CH340G
CH9340K|ESSOP10|免晶振，免驱
CH9340C|SOP16|免晶振，免驱
CH341A|SOP28|USB转串口/IIC/SPI/并口/打印口等
CH341B|SOP28|免晶振，兼容CH341A
CH341F|QFN28|免晶振，兼容CH341A
CH9341F|QFN28|免晶振，可修改PID VID 串口4Mbps
CH9342G|SOP16|USB转双串口
CH9344L|LQFP48|高速USB转4串口
CH9326|SOP16|USB(HID)转串口, 双向透传
CH9328|SOP16|模拟HID键盘,串口数据转HID键盘值上传, 用于条码枪机、电子秤
CH9329|SOP16|CH9326+CH9328 并支持模拟USB鼠标+键盘+USB自定义HID

## Hi3798Mv100 (CA)
-


## 无任何改动log
```shell
tered new interface driver option
usbserial: USB Serial support registered for GSM modem (1-port)
dwc_otg: version 3.00a 10-AUG-2012
Core Release: 3.10a
Setting default values for core params
Using Buffer DMA mode
Dedicated Tx FIFOs mode
g_ffs: file system registered
mousedev: PS/2 mouse device common for all mice
usbcore: registered new interface driver uvcvideo
USB Video Class driver (1.1.1)
device-mapper: ioctl: 4.24.0-ioctl (2013-01-15) initialised: dm-devel@redhat.com
mmc0: BKOPS_EN bit is not set
mmc0: new high speed DDR MMC card at address 0001
mmcblk0: mmc0:0001 004GE0 3.68 GiB 
mmcblk0boot0: mmc0:0001 004GE0 partition 1 2.00 MiB
mmcblk0boot1: mmc0:0001 004GE0 partition 2 2.00 MiB
 mmcblk0: p1(fastboot) p2(bootargs) p3(recovery) p4(deviceinfo) p5(baseparam) p6(pqparam) p7(logo) p8(logobak) p9(nofastplay) p10(nofastplaybak) p11(kernel) p12(misc) p13(system) p14(userdata) p15(cache) p16(params) p17(private) p18(sdcard)
 mmcblk0boot1: unknown partition table
 mmcblk0boot0: unknown partition table
hidraw: raw HID events driver (C) Jiri Kosina
usbcore: registered new interface driver usbhid
usbhid: USB HID core driver
zram: Created 1 device(s) ...
ashmem: initialized
logger: created 256K log 'log_main'
logger: created 256K log 'log_events'
logger: created 256K log 'log_radio'
logger: created 256K log 'log_system'
Registering sdcardfs 2.1.3
usbcore: registered new interface driver snd-usb-audio
oprofile: using timer interrupt.
GACT probability on
Mirror/redirect action on
Failed to load ipt action
Simple TC action Loaded
netem: version 1.3
u32 classifier
    Performance counters on
    input device check on
    Actions configured
Netfilter messages via NETLINK v0.30.
nf_conntrack version 0.5.0 (15770 buckets, 63080 max)
ctnetlink v0.93: registering with nfnetlink.
NF_TPROXY: Transparent proxy support initialized, version 4.1.0
NF_TPROXY: Copyright (c) 2006-2007 BalaBit IT Ltd.
xt_time: kernel timezone is -0000
IPVS: Registered protocols ()
IPVS: Connection hash table configured (size=4096, memory=32Kbytes)
IPVS: Creating netns size=776 id=0
IPVS: ipvs loaded.
ip_tables: (C) 2000-2006 Netfilter Core Team
ipt_CLUSTERIP: ClusterIP Version 0.8 loaded successfully
arp_tables: (C) 2002 David S. Miller
TCP: cubic registered
NET: Registered protocol family 10
ip6_tables: (C) 2000-2006 Netfilter Core Team
NET: Registered protocol family 17
Bridge firewalling registered
Bluetooth: RFCOMM TTY layer initialized
Bluetooth: RFCOMM socket layer initialized
Bluetooth: RFCOMM ver 1.11
Bluetooth: BNEP (Ethernet Emulation) ver 1.3
Bluetooth: BNEP filters: protocol multicast
Bluetooth: BNEP socket layer initialized
Bluetooth: HIDP (Human Interface Emulation) ver 1.2
Bluetooth: HIDP socket layer initialized
8021q: 802.1Q VLAN Support v1.8
lib80211: common routines for IEEE802.11 drivers

VFP support v0.3: implementor 41 architecture 2 part 30 variant 7 rev 5
Load hi_tde.ko success.         (SDK_VERSION:[HiSTBAndroidV600R001C00SPC064_v2016093015] Build Time:[Mar  8 2018, 18:15:58])
mmc1: new high speed SDHC card at address aaaa
mmcblk1: mmc1:aaaa SL08G 7.40 GiB 
Load hi_fb.ko success.  (SDK_VERSION:[HiSTBAndroidV600R001C00SPC064_v2016093015] Build Time:[Mar  8 2018, 18:15:24])
 mmcblk1: p1
DieID is locked!
hisi-sndcard hisi-sndcard:  aiao-hifi <-> hisi-i2s mapping ok
Load hi_png.ko success.         (SDK_VERSION:[HiSTBAndroidV600R001C00SPC064_v2016093015] Build Time:[Mar  8 2018, 18:15:49])
Load hi_jpegenc.ko success.     (SDK_VERSION:[HiSTBAndroidV600R001C00SPC064_v2016093015] Build Time:[Mar  8 2018, 18:15:32])
enter temperature_control_thread
ALSA device list:
  #0: HISI-AIAO
Freeing unused kernel memory: 448K (80efd000 - 80f6d000)
init (1): /proc/1/oom_adj is deprecated, please use /proc/1/oom_score_adj instead.
init: /dev/hw_random not found
init: cannot open '/initlogo.rle'
EXT4-fs (mmcblk0p13): mounted filesystem with ordered data mode. Opts: (null)
EXT4-fs (mmcblk0p14): recovery complete
EXT4-fs (mmcblk0p14): mounted filesystem with ordered data mode. Opts: (null)
EXT4-fs (mmcblk0p15): recovery complete
EXT4-fs (mmcblk0p15): mounted filesystem with ordered data mode. Opts: (null)
EXT4-fs (mmcblk0p16): recovery complete
EXT4-fs (mmcblk0p16): mounted filesystem with ordered data mode. Opts: (null)
EXT4-fs (mmcblk0p17): recovery complete
EXT4-fs (mmcblk0p17): mounted filesystem with ordered data mode. Opts: (null)
init: /dev/hw_random not found
init: [framework] --INIT init properties from devinfo
healthd: No charger supplies found
init: cannot find '/system/bin/rild', disabling 'ril-daemon'
init: cannot find '/system/bin/dbus-daemon', disabling 'dbus'
init: cannot find '/system/etc/install-recovery.sh', disabling 'flash_recovery'
healthd: BatteryStatusPath not found
healthd: BatteryHealthPath not found
healthd: BatteryPresentPath not found
init: cannot find '/system/bin/mtkbt', disabling 'blueangel'
init: cannot find '/system/bin/pqsetting', disabling 'hipq'
init: cannot find '/system/bin/dtvserver', disabling 'dtvserver'
init: cannot find '/system/bin/hidns-sd', disabling 'hidns-sd'
init: cannot find '/system/bin/usb-driver', disabling 'usb-driver'
init: property 'sys.powerctl' doesn't exist while expanding '${sys.powerctl}'
init: powerctl: cannot expand '${sys.powerctl}'
init: property 'sys.sysctl.extra_free_kbytes' doesn't exist while expanding '${sys.sysctl.extra_free_kbytes}'
init: cannot expand '${sys.sysctl.extra_free_kbytes}' while writing to '/proc/sys/vm/extra_free_kbytes'
init: Start system check!healthd: BatteryCapacityPath not found
healthd: BatteryVoltagePath not found
healthd: BatteryTemperaturePath not found
healthd: BatteryTechnologyPath not found
init: VerifySystemList OK!
init: savedFilesCount = 1513
init: no such service 'adbd'
root@HG680J:/ # IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready
init: newFilesCount = 1513
init: VerifyFilesCount OK!


Welcome to HiAndroid




enter low_ram mode


ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
hiusb-ehci hiusb-ehci.0: HIUSB EHCI
hiusb-ehci hiusb-ehci.0: new USB bus registered, assigned bus number 1
hiusb-ehci hiusb-ehci.0: irq 98, io mem 0xf9890000
hiusb-ehci hiusb-ehci.0: USB 0.0 started, EHCI 1.00
Adding 102396k swap on /dev/block/zram0.  Priority:-1 extents:1 across:102396k SS
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 2 ports detected
hiusb-ehci hiusb-ehci.1: HIUSB EHCI
hiusb-ehci hiusb-ehci.1: new USB bus registered, assigned bus number 2
hiusb-ehci hiusb-ehci.1: irq 94, io mem 0xf9930000
hiusb-ehci hiusb-ehci.1: USB 0.0 started, EHCI 1.00
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 1 port detected
ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
hiusb-ohci hiusb-ohci.0: HIUSB OHCI
hiusb-ohci hiusb-ohci.0: new USB bus registered, assigned bus number 3
hiusb-ohci hiusb-ohci.0: irq 99, io mem 0xf9880000
hub 3-0:1.0: USB hub found
hub 3-0:1.0: 2 ports detected
hiusb-ohci hiusb-ohci.1: HIUSB OHCI
hiusb-ohci hiusb-ohci.1: new USB bus registered, assigned bus number 4
hiusb-ohci hiusb-ohci.1: irq 95, io mem 0xf9920000
hub 4-0:1.0: USB hub found
hub 4-0:1.0: 1 port detected
usb 1-2: new high-speed USB device number 2 using hiusb-ehci
device eth0 entered promiscuous mode
hiusb-xhci hiusb-xhci.0: xHCI Host Controller
hiusb-xhci hiusb-xhci.0: new USB bus registered, assigned bus number 5
hiusb-xhci hiusb-xhci.0: irq 101, io mem 0xf98a0000
hub 5-0:1.0: USB hub found
hub 5-0:1.0: 1 port detected
hiusb-xhci hiusb-xhci.0: xHCI Host Controller
hiusb-xhci hiusb-xhci.0: new USB bus registered, assigned bus number 6
hub 6-0:1.0: USB hub found
hub 6-0:1.0: 1 port detected
usbcore: registered new interface driver bt_usb
<1>csr_usb: CSR USB driver registered
BT_USB: major 249
bt_usb_construct_device 0
bt_usb_construct_device 1
bt_usb_construct_device 2
tntfs: module license 'Commercial. For support email ntfs-support@tuxera.com.' taints kernel.
Disabling lock debugging due to kernel taint
Tuxera NTFS driver 3015.1.29.1.1 [Flags: R/W MODULE].
create enforce
csr hid driver init
[1231168542 ERROR-HI_HDMI]:DRV_HDMI_SetCECCommand[1413]:CEC do not start
warning: `zygote' uses 32-bit capabilities (legacy support in use)
lowmemorykiller: lowmem_shrink: convert oom_adj to oom_score_adj:
lowmemorykiller: oom_adj 0 => oom_score_adj 0
lowmemorykiller: oom_adj 1 => oom_score_adj 58
lowmemorykiller: oom_adj 2 => oom_score_adj 117
lowmemorykiller: oom_adj 3 => oom_score_adj 176
lowmemorykiller: oom_adj 9 => oom_score_adj 529
lowmemorykiller: oom_adj 15 => oom_score_adj 1000
EXT4-fs (mmcblk0p18): recovery complete
EXT4-fs (mmcblk0p18): mounted filesystem with ordered data mode. Opts: share
FAT-fs (mmcblk1p1): Volume was not properly unmounted. Some data may be corrupt. Please run fsck.
init: VerifyFilesHash OK!
init: untracked pid 2543 exited
alloc_contig_range test_pages_isolated(2b8f1, 2b911) failed




init: sys_prop: Unable to start service ctl [IptvServ] uid:10024 gid:10024 pid:2222
init: sys_prop: Unable to start service ctl [sy_tr069] uid:10024 gid:10024 pid:2222
bt_usb: no device probed yetdevice eth0 entered promiscuous mode
```