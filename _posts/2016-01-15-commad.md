---
layout: post
title:  "常用命令"
date:   2016-01-15 11:28:00
categories: Other
excerpt: 常用命令。
---

* content
{:toc}

## linux
01. top 显示当前运行的进程信息
02. scp 服务器文件同步
03. mpstat cpu分片情况
04. netstat 网络信息
05. dmesg 硬件驱动、丢包等问题
06. stap perf 系统分析性能分析
07. sar 显示cpu、内存、网络历史情况
08. /proc/* ... 现场调试
09. ldd 检查共享库
10. strace ltrace 查看程序运行失败、冻结、奔溃后堆栈等信息
11. wireshark tshark 网络调试
12. iftop nethogs 查看端口或进程占用的带宽
13. mtr traceroute 查看网络问题
14. free vmstat 查看内存状态
15. iostat netstat top atop htop dstat 查看系统状态
16. split csplit分割文件
17. strings grep 在二进制文件中查找文本
18. hd bvi 16进制抽取、二进制编辑
19. sort 排序
20. shuf 从文件中随机选一些行
21. awk 复杂数据替换修改
22. lsof netstat -lntp 查询进程监听端口、文件等
23. nohup disown screen tmux 后台运行
24. pgrep pkill pstree -p 进程操作
25. parallel 并行执行任务
26. xargs 模拟执行脚本
27. uptime 系统负载
28. ps 查看进程信息 aux
29. fuser 显示文件被那些进程访问
30. stfp传文件
31. rsync -avz --delete /var/www/ root@ip:/root/www
32. nice -n[-20 19] 命令 指定优先级
33. renice [-20 19] pid 设置优先级
34. slabtop 显示linux内核缓存使用情况
35. tail -10 显示文件最后10行
36. head -10 显示开头10行
37. debian apt-get install build-essential
38. centos yum groupinstall "Development tools"
39. rz sz 上传下载工具

## mac
01. lipo 富二进制操作 显示信息、合并、编辑
02. nm 显示库符号 
03. xcode插件问题defaults delete com.apple.dt.Xcode DVTPlugInManagerNonApplePlugIns-Xcode-{your_xcode_version} 
04. sysctl 查看内核变量值 -a、debug、hw、kern machdep、net、vfs、vm、user
05. auditd 审计日志在/var/audit praudit可以解析文件 auditreduce 搜索日志
06. dscl 用户和组操作
07. scutil 命令行系统设置
08. syslogd asl_log、asl_*系统日志
09. plutil -convert xml、binary、json 1 文件转换
10. notifyutil 通知 信号 进程通信
11. security 密钥工具 -i
12. csreq
13. codesign 签名     
14. asctl 控制跟踪沙盒
15. file 显示文件信息
16. arch 强制加载二进制中某架构的代码
17. otool Mach-o文件工具 -hV、-lV、-L、-p _main -tV
18. codesign 修改显示代码签名
19. pagestuff -a 显示逻辑页符号
20. vmmap -interleaved 查看进程内存布局
21. vm_stat 显示内核虚拟内存计数
22. defaults 设置系统默认配置
23. dtrace 调试语言 Instruments利用它的脚本实现 -s -n 在内核态执行(/dev/device字符设备与内核通信)
24. dtruss 显示系统调用、参数、返回值 -p -n -s -f
25. system_profiler 系统信息
26. sysdiagnose 系统诊断 命令脚本
27. allmemory 所有进程内存快照 -o 指定文件(/tmp/allmemoryfiles)
28. fs_usage 显示进程与文件、套接字、目录相关的系统调用
29. sc_usage 显示进程的系统调用信息 -l
30. latency 显示进程中断和调度的延迟值 -st -it
31. ulimit 核心转储大小限制 -c 返回0表示不创建
32. spindump 将所有进程当前的调用栈写入日志
33. sample 获取某个进程的快照
34. filtercalltree 处理调用跟踪日志
35. heap 显示堆中分配的缓存区
36. leaks 列出可能的内存泄漏
37. malloc_history 列出每一次内存分配的详细信息
38. nvram、ioreg 访问NVRAM
39. bless 控制修改NVRAM参数 
40. od -A x -t x4 path 文件显示十六进制内容
41. launchctl 与launchd交互管理后台守护进程
42. mig根据Mach接口定义文件生成代码
43. zprint 显示内核中Zone信息
44. auditon 审计相关
45. diskutil
46. newfs_msdos newfs_hfs newfs_apfs newfs_exfat newfs_udf
47. gpt -r show disk add create -t efi ...
48. 11. diskutil erasevolume HFS+ "/Volumes/dir" $(hdiutil attach -nomount suppressed ram://blocks(512字节)) 创建内存盘，并挂载
49. history -c 清除 !命令序号 重复执行某历史命令

## centos
01. uname -a 和 more /etc/*release
02. cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c 查看cpu逻辑内核
03. cat /proc/cpuinfo | grep physical | uniq -c 物理内核
04. getconf LONG_BIT 系统字节宽度
05. cat /proc/meminfo 内存
06. df -h 硬盘信息 

##sed 命令
01. -n 使用安静(silent)模式
02. -e 直接在命令列模式上进行 sed 的动作编辑；
03. -f -f filename 运行filename内的 sed 动作；
04. -r sed 支持延伸型正则表达式。默认是基础正则表达式
05. -i 直接修改读取的文件内容，而不是输出到终端。
06. sed [n1[,n2]] function 可选n1行到n2行
07. function a新增 c取代 d删除 i插入 p列印 s取代

## vim
01. :help、:q、:wq
02. :set nu 显示行号
03. /需查找的词\c 向后查找 \c 忽略大小写
04. ?需查找的词\c 向前查找 \c 忽略大小写
05. n向下查找下一个 N向上查找下一个
06. Ctrl+f 向下翻页 Ctrl+b 向上翻页
07. Shift+$行尾 Shift+|行头
08. gg文件开始 GG文件结尾
09. w按词向下移动 b按词向上移动
10. dd 删除行、d2d向下删除两行、x删除字、dw删除词、d2w删除2个词
11. p向下粘帖刚刚删除的行货字符等、P向上粘帖、Shift+Insert
12. :/原词/替换词/g g替换每行命中所有词， 没有g只替换每行第一个命中词
13. u 回退、Ctrl+R重做
14. i 插入、a追加、O向前插入行、o向后插入行

## brew
001. brew update 更新信息
002. brew outdated 查看哪些可以升级
003. brew upgrade [xxx] 升级全部或指定软件
004. brew clean 清理旧的版本
005. brew search xxxx
006. brew info xxx     

## System V服务脚本
01. rcS.d->rc(0-6).d->rc.local
02. /ect/rc(0-6).d 0-6类别的启动脚本 K开头的脚本比S开头的早运行 0关机 1 单用户 2网络多用户 3网络服务多用户 4 5  6重启
03. 脚本内容 start stop reload restart force-reload 
04. action `$"Starting name:" nohup /*/s param >/dev/null 2>&1 &` 
05. `pidof name` 获取pid
06. `killproc -p pidfile -TERM "name"` 
07. 脚本放在/etc/init.d
08. update-rc.d service <enable|disable|start|stop> [order级别] [1 2 3类别]

## systemd 服务脚本
01. /usr/lib/systemd/system 脚本.service
02. systemctl <enable|start|status|stop|kill|restart> name 
03. systemctl cat name 显示脚本
04. systemctl list-dependencies multi-user.target
05. systemctl isolate shutdown.target 切换target
06. systemctl daemon-reload 重新加载配置
07. 脚本

        [Unit] 启动循序与依赖关系
        Description=NMLIS is sample
        Documentation=man:NMLIHelp(8) 帮助文件
        After=server1 server2 在这些后面启动
        Before=server3 server4 在这些前面启动
        Wants=server5 此服务失败停止不影响自己
        Requires=server6 此服务失败自己也关闭
        [Service]启动方法 (- 表示本条失败也可以继续)
        Environment=设置环境变量
        EnvironmentFile=-path 内容为key=value
        ExecStart=path/s -config $conf(来自上面文件)
        ExecReload=/bin/kill -HUP $MAINPID
        ExecStop=停止执行的命令
        ExecStartPre=启动服务前执行的命令
        ExecStartPost=启动后执行的命令
        ExecStopPost=停止后执行的命令
        xxx= 空行取消前面相同xxx的设置
        Type=simple 默认 主进程
        Type=forking 程序fork 主进程退出、子进程变主
        Type=oneshot 类似simple 执行一次等待完成
        Type=dbus 类似simple 等待D-Bus信号后启动
        Type=idle 类似simple 其它任务都执行完启动该服务
        RemainAfterExit=yes 可以再次运行针对oneshot
        KillMode=control-group默认控制组所有进程被杀掉
        KillMode=process 只杀主进程
        KillMode=mixed 主进程SIGTERm 子进程SIGKILL
        KillMode=none 不杀进程 只是执行stop
        Restart=no默认 退出后不重启
        Restart=on-success 正常退出才会重启
        Restart=on-failure 非正常退出 重启
        Restart=on-abnormal 被信号终止或超时 重启
        Restart=on-abort被没有捕捉的信号终止时 重启
        Restart=on-watchdog 超时重启
        Restart=always 总是重启
        RestartSec=10 重启前等待秒
        [Install]如何安装配置
        WantedBy=multi-user.target 多用户模式 默认
        WantedBy=local-fs-pre.target
        WantedBy=sysinit.target
        WantedBy=basic.target
        WantedBy=graphical.target
        WantedBy=shutdown.target
        WantedBy=umount.target
        WantedBy=final.target
        
        
## vc dumpbin option file | find /i ".dll" | more
- /ALL
- /ARCHIVEMEMBERS 显示库中成员的基本信息
- /CLRHEADER 公共语言运行时
- /DEPENDENTS 显示出所依赖的DLLs的名字,但不现实导入函数的名字。
- /DIRECTIVES 显示编译器产生的.drective（链接时的参数）段中的信息。
- /DISASM[:{BYTES|NOBYTES}]显示代码段反汇编的结果
- /ERRORREPORT:{NONE|PROMPT|QUEUE|SEND}如果dumpbin.exe在运行时失败，你能使用"/ERRORREPORT"这个参数去发送错误信息到微软
- /EXPORTS 显示可执行文件或DLL中导出的所有信息。
- /FPO 显示FPO( frame pointer optimization)记录。
- /HEADERS 显示文件和每个段的头部信息。当使用一个库文件时，它显示的是每个成员对象的头部信息。
- /IMPORTS[:文件名]显示可执行文件或DLL文件中导入的DLL文件和它的函数列表。
- /LINENUMBERS 如果编译时使用了/Zi,/C7/Zd选项，行编号才存在于目标文件中，或者在连接时产生了调试信息是才能够显示行编号。
- /LINKERMEMBER[:{1|2}]这个选项显示定义在库中的全局符号。如果"1"被指定将以对象的顺序显示对象以及他们相应的偏移量，如果"2"被指定将显示偏移和
- /LOADCONFIG 这个选项会显示"IMAGE_LOAD_CONFIG_DIRECTORY"结构体中的相关信息，这个结构体是在文件加载时加载选项。
- /OUT:文件名 这个选项将信息输出到指定的文件中。
- /PDATA 这个参数只对RISC处理器才有用。显示.pdata中的相关信息。
- /PDBPATH[:VERBOSE]
- /RANGE:vaMin[,vaMax]
- /RAWDATA[:{NONE|1|2|4|8}[,#]] 显示原始数据（比如.text段中的指令数据）。你可以使用下列参数来格式化输出。


        1 默认值，数据以十六进制显示，如果有打印字符就显示他的assii码。
        2 数据以十六进制2字节形式显示。
        4 数据以十六进制4字节形式显示。
        8 数据以十六进制8字节形式显示。
        NONE 数据被限制，这个参数可以配合/ALL一起使用来控制输出。
        Number 以设定值来显示。
- /RELOCATIONS 显示对象中的重定位信息。
- /SECTION:名称 显示由"section"指定段中的信息。你可以使用"/HEADERS"选项去显示每个段的头部信息。
- /SUMMARY 显示每个段的基本信息(段名和大小)，如果其他选项没有指定这个选项是默认的。
- /SYMBOLS 这个参数会显示COFF文件的符号表（用于连接时从定位的）。在所有的对象中都存在符号表
- /TLS 显示一个来自可执行文件中的"IMAGE_TLS_DIRECTORY"结构体的信息
- /UNWINDINFO 这个选项只能使用于 Itanium处理器。


## sample
01. find / -name "*.d" -print0 | xargs -I{} -0 cp -v {}  /Users
02. 下载文件 scp root@ip:/var/1.txt  /1.txt
03. 上传文件 scp -P 22 /1.txt root@ip:/var/1.txt
04. 下载目录 scp -P 22 -r root@ip:/var/ /www/
05. 上传目录 scp -P 22 -r /www/  root@ip:/var/
06. apt-get install build-essential 
07. 不挂起 nohup * &
08. 本地端口查看 netstat -anp  lsof -i | grep 1979
09. 检测远端端口 telnet host 80 nmap ip -p port nc -v host port
10. 压缩 tar -zcvf rsc.tar.gz rsc
11. 解压 tar -zxvf rsc.tar.gz 
12. deb安装 dpkg -i
13. 密钥登陆 .ssh/authorized_keys chmod 600 .ssh/authorized_keys /etc/ssh/sshd_conf 禁止密码
14. netstat -lntp 查看开启了哪些端口
15. python -m SimpleHTTPServer 7988 简单http服务
16. ls -lh
17. find dir1 dir2... -not -path "*/vendor/*" -name "*.go" -not -name "*_test.go" | wc -l 统计文件数
18. find dir1 dir2... -not -path "*/vendor/*" -name "*.go" -not -name "*_test.go"| xargs cat | wc -l 统计行
